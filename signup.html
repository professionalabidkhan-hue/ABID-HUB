<script>
    console.log("SENTINEL: Mastery Script Loaded and Ready.");

    document.addEventListener('DOMContentLoaded', () => {
        // Safe-Link function to prevent "null" errors
        const linkInput = (id, event, action) => {
            const el = document.getElementById(id);
            if (el) el[event] = action;
            else console.warn(`SENTINEL: Element with ID '${id}' not found.`);
        };

        // 1. IDENTITY PREVIEW UPDATERS (Safe-Linked)
        linkInput('name', 'oninput', (e) => {
            const preview = document.getElementById('preview-name');
            if (preview) preview.innerText = e.target.value || "Member Name";
        });

        linkInput('location', 'oninput', (e) => {
            const preview = document.getElementById('preview-location');
            if (preview) preview.innerText = e.target.value || "---";
        });

        linkInput('course', 'onchange', (e) => {
            const preview = document.getElementById('preview-course');
            if (preview) preview.innerText = e.target.options[e.target.selectedIndex].text;
        });

        // 2. THE MASTER SIGNUP STRIKE
        const signUpBtn = document.getElementById('SignUp');
        if (signUpBtn) {
            signUpBtn.onclick = async function() {
                console.log("STRIKE: Visionary initiated the SignUp Protocol.");
                
                // Collect data with safety
                const getVal = (id) => document.getElementById(id) ? document.getElementById(id).value : '';

                const signupData = {
                    full_name: getVal('name'),
                    email: getVal('email'),
                    password: getVal('password'),
                    whatsapp_no: getVal('phone'),
                    father_name: getVal('father_name'),
                    monthly_income: getVal('monthly_income'),
                    preferred_timing: getVal('preferred_timing'),
                    location: getVal('location'),
                    department: getVal('course'),
                    role: getVal('role')
                };

                if(!signupData.email || !signupData.password) {
                    alert("SENTINEL: Email and Password are required.");
                    return;
                }

                alert("COMMAND RECEIVED: Attempting Vault Entry...");

                try {
                    const response = await fetch('./connect_hub.php', {
                        method: 'POST',
                        headers: { 'Content-Type': 'application/json' },
                        body: JSON.stringify(signupData)
                    });

                    const result = await response.json();
                    alert("SERVER RESPONSE: " + result.message);
                    if(result.success) window.location.href = 'signin.html';
                    
                } catch (error) {
                    console.error("STRIKE ERROR:", error);
                    alert("SENTINEL: The Bridge is blocked. Ensure connect_hub.php exists.");
                }
            };
        }
    });
</script>
